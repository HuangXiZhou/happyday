const got = require('got')

function getWeather (apiKey, city) {
  if (!apiKey) {
    throw new Error('An api key must be provided')
  }

  if (!city) {
    throw new Error('A city must be provided')
  }

  const root = 'api.openweathermap.org'
  const path = '/data/2.5/weather'
  const temperaturUnit = 'metric'
  const url = `${root}${path}?q=${city}&units=${temperaturUnit}&appid=${apiKey}`

  return got(url)
    .then(response => {
      const weather = JSON.parse(response.body)
      return weather.main.temp
    })
    .catch(console.error)
}

module.exports = getWeather

if (!module.parent) {
  const args = process.argv.slice(2)
  const DEFAULT_CITY = 'Paris'
  const city = args[0] || DEFAULT_CITY
  getWeather(process.env.API_KEY, city)
    .then(temperature => {
      console.log('il fait ' + temperature);
    })
}
